# ğŸ† Application Registre des Ventes de PÃ©tards
## Squelette Complet et SpÃ©cifications Techniques

---

## ğŸ“‹ **Vue d'ensemble de l'Application**

### **Objectif**
Application web React pour la gestion et le suivi rÃ©glementaire des ventes de feux d'artifice et pÃ©tards, conforme Ã  la lÃ©gislation franÃ§aise.

### **Utilisateurs cibles**
- CommerÃ§ants vendant des feux d'artifice
- Responsables de magasins spÃ©cialisÃ©s
- ContrÃ´leurs rÃ©glementaires



## ğŸ® **Interface Utilisateur**

### **Navigation Principale**
```
Header: "Registre des Ventes de PÃ©tards"
â””â”€â”€ Onglets Navigation:
    â”œâ”€â”€ ğŸ“ Nouvelle Vente
    â””â”€â”€ ğŸ“Š Historique (X ventes)
```

### **Palette de Couleurs**
- **Primaire**: Bleu (#2563EB)
- **SuccÃ¨s**: Vert (#16A34A)
- **Erreur**: Rouge (#DC2626)
- **Info**: Bleu clair (#3B82F6)
- **ArriÃ¨re-plan**: Gris clair (#F9FAFB)

---

## ğŸ“ **Section 1: Nouvelle Vente**

### **Formulaire Complet**

#### **ğŸ§‘â€ğŸ’¼ Informations Vendeur**
```javascript
{
  vendeur: {
    type: "string",
    required: true,
    placeholder: "Nom et prÃ©nom du vendeur",
    validation: "Non vide"
  },
  dateVente: {
    type: "date",
    default: "Date du jour",
    format: "YYYY-MM-DD"
  }
}
```

#### **ğŸ“¦ Informations Produit**
```javascript
{
  typeArticle: {
    type: "select",
    required: true,
    options: [
      "PÃ©tard Ã  mÃ¨che",
      "Batterie", 
      "Batterie nÃ©cessitant un support externe",
      "Combinaison",
      "Combinaison nÃ©cessitant un support externe", 
      "PÃ©tard aÃ©rien",
      "PÃ©tard Ã  composition flash",
      "FusÃ©e",
      "Chandelle romaine",
      "Chandelle monocoup"
    ]
  },
  categorie: {
    type: "select",
    required: true,
    dependsOn: "typeArticle",
    mapping: {
      "PÃ©tard Ã  mÃ¨che": ["F3"],
      "Batterie": ["F3"],
      "Batterie nÃ©cessitant un support externe": ["F3"],
      "Combinaison": ["F3"],
      "Combinaison nÃ©cessitant un support externe": ["F3"],
      "PÃ©tard aÃ©rien": ["F2", "F3"],
      "PÃ©tard Ã  composition flash": ["F3"],
      "FusÃ©e": ["F2", "F3"],
      "Chandelle romaine": ["F2", "F3"],
      "Chandelle monocoup": ["F2", "F3"]
    }
  },
  quantite: {
    type: "number",
    required: true,
    min: 1,
    validation: "Entier positif"
  },
  gencode: {
    type: "string",
    required: false,
    placeholder: "Code produit (optionnel)"
  }
}
```

#### **ğŸ§‘â€ğŸ¤â€ğŸ§‘ Informations Client**
```javascript
{
  nom: {
    type: "string",
    required: true,
    placeholder: "Nom de famille"
  },
  prenom: {
    type: "string", 
    required: true,
    placeholder: "PrÃ©nom"
  },
  dateNaissance: {
    type: "date",
    required: false,
    placeholder: "Date de naissance"
  },
  lieuNaissance: {
    type: "string",
    required: false,
    placeholder: "Ville de naissance"
  }
}
```

#### **ğŸ†” PiÃ¨ce d'IdentitÃ©**
```javascript
{
  typeIdentite: {
    type: "string",
    required: false,
    placeholder: "Ex: CNI 123456789",
    examples: ["CNI", "Passeport", "Permis de conduire"]
  },
  autoriteDelivrance: {
    type: "string",
    required: false,
    placeholder: "PrÃ©fecture, Mairie, etc."
  },
  dateDelivrance: {
    type: "date",
    required: false
  }
}
```

#### **ğŸ“· Photos de la PiÃ¨ce d'IdentitÃ©**
```javascript
{
  photoRecto: {
    type: "image",
    format: "base64",
    source: "camera",
    required: false,
    compression: 0.8,
    maxSize: "5MB"
  },
  photoVerso: {
    type: "image", 
    format: "base64",
    source: "camera",
    required: false,
    compression: 0.8,
    maxSize: "5MB"
  }
}
```

### **Informations RÃ©glementaires**
```
â„¹ï¸ Information rÃ©glementaire :
â€¢ F2 : Feux d'artifice de catÃ©gorie F2 - Vente libre aux majeurs
â€¢ F3 : Feux d'artifice de catÃ©gorie F3 - Vente soumise Ã  autorisation prÃ©fectorale
```

### **Actions du Formulaire**
- **ğŸ’¾ Enregistrer la Vente** (bouton principal)
- **ğŸ“¸ Prendre photo Recto/Verso** (boutons camÃ©ra)
- **âŒ Supprimer photo** (boutons X sur images)

---

## ğŸ“Š **Section 2: Historique des Ventes**

### **Actions Globales**
```javascript
{
  exportCSV: {
    label: "ğŸ“¥ Exporter CSV (X)",
    function: "exportToCSV()",
    disabled: "si aucune vente",
    format: "UTF-8 avec BOM"
  },
  backupAuto: {
    label: "ğŸ’¾ Backup Auto", 
    function: "downloadAutoBackup()",
    source: "localStorage"
  },
  diagnostic: {
    label: "ğŸ” Debug",
    function: "Diagnostic complet console"
  },
  testSuppression: {
    label: "ğŸ§ª Test Suppression",
    function: "Test sur premiÃ¨re vente"
  },
  testBackup: {
    label: "ğŸ§ª Test Backup",
    function: "Test crÃ©ation + tÃ©lÃ©chargement"
  }
}
```

### **Informations de Status**
```
ğŸ“Š DonnÃ©es stockÃ©es localement (X vente(s)) â€¢ Export CSV compatible Excel â€¢ Sauvegarde automatique Ã  chaque ajout
Dernier backup: DD/MM/YYYY HH:MM (X enreg.)
```

### **Tableau des Ventes**
```javascript
{
  colonnes: [
    {
      nom: "Date",
      champ: "dateVente", 
      format: "DD/MM/YYYY",
      tri: "DESC par dÃ©faut"
    },
    {
      nom: "Vendeur",
      champ: "vendeur",
      fallback: "Non spÃ©cifiÃ©"
    },
    {
      nom: "Client", 
      champ: "nom + prenom",
      sousChamp: "typeIdentite"
    },
    {
      nom: "Produit",
      champ: "typeArticle",
      sousChamp: "gencode (si prÃ©sent)"
    },
    {
      nom: "CatÃ©gorie",
      champ: "categorie",
      style: {
        "F2": "badge jaune",
        "F3": "badge rouge"
      }
    },
    {
      nom: "QuantitÃ©",
      champ: "quantite"
    },
    {
      nom: "Actions",
      boutons: ["ğŸ‘ï¸ Voir", "ğŸ—‘ï¸ Supprimer"]
    }
  ]
}
```

### **Actions par Ligne**
```javascript
{
  voirDetails: {
    icon: "ğŸ‘ï¸",
    action: "Ouvrir modal dÃ©tails",
    tooltip: "Voir les dÃ©tails"
  },
  supprimer: {
    icon: "ğŸ—‘ï¸", 
    action: "Suppression avec confirmation",
    tooltip: "Supprimer la vente",
    confirmation: "Supprimer dÃ©finitivement la vente de {nom} {prenom} ?\n\nâš ï¸ Cette action est irrÃ©versible !\n\nID: {id}"
  }
}
```

---

## ğŸ” **Modal de DÃ©tails**

### **Structure ComplÃ¨te**
```javascript
{
  titre: "DÃ©tails de la Vente",
  sections: [
    {
      nom: "Informations Vendeur",
      champs: ["vendeur", "dateVente"]
    },
    {
      nom: "Informations Produit", 
      champs: ["typeArticle", "categorie", "quantite", "gencode"]
    },
    {
      nom: "Informations Client",
      champs: ["nom", "prenom", "dateNaissance", "lieuNaissance"]
    },
    {
      nom: "PiÃ¨ce d'IdentitÃ©",
      champs: ["typeIdentite", "autoriteDelivrance", "dateDelivrance"]
    },
    {
      nom: "Photos de la PiÃ¨ce d'IdentitÃ©",
      champs: ["photoRecto", "photoVerso"],
      affichage: "Images 128px ou placeholder"
    },
    {
      nom: "Informations SystÃ¨me",
      champs: ["timestamp"],
      format: "DD/MM/YYYY HH:MM:SS"
    }
  ],
  actions: ["Fermer"]
}
```

---

## ğŸ“¸ **Modal CamÃ©ra**

### **Interface CamÃ©ra**
```javascript
{
  titre: "Photo {Recto|Verso}",
  elements: [
    {
      videoStream: {
        source: "navigator.mediaDevices.getUserMedia",
        constraints: { 
          video: { facingMode: 'environment' } 
        },
        autoPlay: true,
        playsInline: true
      }
    },
    {
      canvas: {
        hidden: true,
        purpose: "Capture image"
      }
    }
  ],
  actions: [
    {
      nom: "ğŸ“¸ Prendre la photo",
      function: "takePhoto()"
    },
    {
      nom: "âŒ Fermer",
      function: "stopCamera()"
    }
  ]
}
```

### **Processus de Capture**
1. **Demande permission camÃ©ra**
2. **Affichage flux vidÃ©o temps rÃ©el**
3. **Capture frame sur canvas**
4. **Conversion en blob JPEG (80% qualitÃ©)**
5. **Conversion en base64**
6. **Stockage dans formData**
7. **ArrÃªt du flux camÃ©ra**

---

## ğŸ¯ **SystÃ¨me de Notifications (Toast)**

### **Types de Notifications**
```javascript
{
  success: {
    couleur: "Vert",
    icon: "âœ… CheckCircle",
    duree: 4000,
    exemples: [
      "Vente enregistrÃ©e avec succÃ¨s",
      "Photo recto capturÃ©e avec succÃ¨s", 
      "Export rÃ©ussi ! X vente(s) exportÃ©e(s)",
      "Vente de {nom} {prenom} supprimÃ©e"
    ]
  },
  error: {
    couleur: "Rouge",
    icon: "âŒ AlertCircle", 
    duree: 4000,
    exemples: [
      "Veuillez remplir tous les champs obligatoires",
      "Impossible d'accÃ©der Ã  la camÃ©ra",
      "Erreur lors de l'enregistrement"
    ]
  },
  info: {
    couleur: "Bleu",
    icon: "â„¹ï¸ Info",
    duree: 4000,
    exemples: [
      "CamÃ©ra activÃ©e, positionnez la carte d'identitÃ©",
      "Photo recto supprimÃ©e",
      "Aucune vente Ã  exporter"
    ]
  }
}
```

### **Positionnement et Animation**
```css
{
  position: "fixed bottom-4 right-4",
  zIndex: 50,
  animation: "slideInRight 0.3s ease-out",
  autoRemove: "4 secondes",
  manualClose: "Bouton X"
}
```

---

## ğŸ—„ï¸ **Base de DonnÃ©es (IndexedDB)**

### **Configuration**
```javascript
{
  nom: "VentesPetardsDB",
  version: 1,
  objectStore: {
    nom: "ventes",
    keyPath: "id",
    autoIncrement: true,
    index: [
      { nom: "nom", unique: false },
      { nom: "dateVente", unique: false }
    ]
  }
}
```

### **Structure d'un Enregistrement**
```javascript
{
  id: "number (auto-increment)",
  
  // Vendeur
  vendeur: "string",
  dateVente: "string (YYYY-MM-DD)",
  
  // Produit  
  typeArticle: "string",
  categorie: "string (F2|F3)",
  quantite: "number",
  gencode: "string|null",
  
  // Client
  nom: "string", 
  prenom: "string",
  dateNaissance: "string|null",
  lieuNaissance: "string|null",
  
  // IdentitÃ©
  typeIdentite: "string|null",
  numeroIdentite: "string|null",
  autoriteDelivrance: "string|null", 
  dateDelivrance: "string|null",
  
  // Photos
  photoRecto: "string (base64)|null",
  photoVerso: "string (base64)|null",
  
  // SystÃ¨me
  timestamp: "string (ISO 8601)"
}
```

### **OpÃ©rations CRUD**
```javascript
{
  create: "saveVente(venteData)",
  read: "loadVentes() -> Array",
  update: "Non implÃ©mentÃ©",
  delete: "deleteVente(id)"
}
```

---

## ğŸ’¾ **SystÃ¨me de Sauvegarde**

### **Sauvegarde Automatique (localStorage)**
```javascript
{
  clÃ©: "petards_backup_csv",
  dÃ©clencheurs: [
    "AprÃ¨s ajout vente",
    "AprÃ¨s suppression vente"
  ],
  contenu: {
    timestamp: "ISO 8601",
    csvContent: "string (avec BOM UTF-8)",
    recordCount: "number"
  }
}
```

### **Export CSV Manuel**
```javascript
{
  format: "CSV dÃ©limitÃ© par ';'",
  encodage: "UTF-8 avec BOM (\uFEFF)",
  colonnes: [
    "Date de vente",
    "Vendeur", 
    "Type d'article",
    "CatÃ©gorie",
    "QuantitÃ©",
    "Code gÃ©nÃ©rique",
    "Nom client",
    "PrÃ©nom client", 
    "Date de naissance",
    "Lieu de naissance",
    "Type et nÂ° identitÃ©",
    "AutoritÃ© de dÃ©livrance",
    "Date de dÃ©livrance",
    "Photo recto (Oui/Non)",
    "Photo verso (Oui/Non)",
    "Horodatage"
  ],
  mÃ©thodes: [
    "Data URL (principal)",
    "Blob + createObjectURL (fallback)",
    "Nouvelle fenÃªtre (fallback final)"
  ]
}
```

---

## âš™ï¸ **Ã‰tats et Gestion des DonnÃ©es**

### **Ã‰tat Principal (useState)**
```javascript
{
  activeTab: "string ('nouvelle-vente'|'historique')",
  ventes: "Array<VenteObject>",
  showCamera: "boolean",
  currentPhotoType: "string ('photoRecto'|'photoVerso')",
  toasts: "Array<ToastObject>",
  showDetailsModal: "boolean", 
  selectedVente: "VenteObject|null",
  formData: "VenteObject (form state)"
}
```

### **RÃ©fÃ©rences (useRef)**
```javascript
{
  videoRef: "HTMLVideoElement",
  canvasRef: "HTMLCanvasElement", 
  streamRef: "MediaStream"
}
```

### **Effets (useEffect)**
```javascript
{
  componentDidMount: [
    "initDB()",
    "loadVentes()"
  ]
}
```

---

## ğŸ”§ **Fonctions Principales**

### **Base de DonnÃ©es**
```javascript
{
  initDB: "Initialisation IndexedDB",
  saveVente: "Ajout nouvelle vente",
  loadVentes: "Chargement toutes ventes", 
  deleteVente: "Suppression vente par ID"
}
```

### **CamÃ©ra et Photos**
```javascript
{
  startCamera: "DÃ©marrage flux camÃ©ra",
  takePhoto: "Capture photo sur canvas",
  stopCamera: "ArrÃªt flux camÃ©ra"
}
```

### **Formulaire**
```javascript
{
  handleInputChange: "Gestion changements inputs",
  handleSubmit: "Soumission formulaire complet"
}
```

### **Export et Sauvegarde**
```javascript
{
  exportToCSV: "Export CSV manuel",
  createAutoBackup: "CrÃ©ation backup auto",
  downloadAutoBackup: "TÃ©lÃ©chargement backup"
}
```

### **Interface Utilisateur**
```javascript
{
  showToast: "Affichage notification",
  removeToast: "Suppression notification",
  ToastContainer: "Container notifications",
  DetailsModal: "Modal dÃ©tails vente"
}
```

---

## ğŸ›ï¸ **Configuration et Options**

### **ParamÃ¨tres GÃ©nÃ©raux**
```javascript
{
  autoBackup: true,
  toastDuration: 4000,
  photoCompression: 0.8,
  csvDelimiter: ';',
  dateFormat: 'fr-FR'
}
```

### **Validation des Champs**
```javascript
{
  champsObligatoires: [
    "vendeur",
    "nom", 
    "prenom",
    "typeArticle",
    "categorie", 
    "quantite"
  ],
  validations: {
    quantite: "min: 1, type: number",
    dateVente: "format: YYYY-MM-DD",
    photos: "maxSize: 5MB, format: JPEG"
  }
}
```

### **Correspondances Produits**
```javascript
{
  articlesTypesCategories: {
    "PÃ©tard Ã  mÃ¨che": ["F3"],
    "Batterie": ["F3"], 
    "Batterie nÃ©cessitant un support externe": ["F3"],
    "Combinaison": ["F3"],
    "Combinaison nÃ©cessitant un support externe": ["F3"],
    "PÃ©tard aÃ©rien": ["F2", "F3"],
    "PÃ©tard Ã  composition flash": ["F3"],
    "FusÃ©e": ["F2", "F3"],
    "Chandelle romaine": ["F2", "F3"],
    "Chandelle monocoup": ["F2", "F3"]
  }
}
```

---

## ğŸš€ **Flux de DonnÃ©es Complet**

### **Ajout d'une Vente**
```
1. Utilisateur remplit formulaire
2. Validation champs obligatoires
3. Prise photos (optionnel)
4. Clic "Enregistrer la Vente"
5. saveVente() -> IndexedDB
6. loadVentes() -> Mise Ã  jour Ã©tat
7. createAutoBackup() -> localStorage
8. Toast de succÃ¨s
9. Reset formulaire
```

### **Affichage Historique**
```
1. Clic onglet "Historique"
2. loadVentes() depuis IndexedDB
3. Tri par date (DESC)
4. Affichage tableau
5. Actions disponibles par ligne
```

### **Export CSV**
```
1. Clic "Exporter CSV"
2. VÃ©rification ventes > 0
3. Transformation donnÃ©es -> CSV
4. CrÃ©ation blob avec BOM UTF-8
5. DÃ©clenchement tÃ©lÃ©chargement
6. Toast de confirmation
```

### **Suppression Vente**
```
1. Clic bouton suppression
2. Confirmation utilisateur
3. deleteVente(id) -> IndexedDB
4. loadVentes() -> Mise Ã  jour Ã©tat
5. createAutoBackup() -> localStorage
6. Toast de succÃ¨s
```

---

## ğŸ›¡ï¸ **ConformitÃ© RÃ©glementaire**

### **Exigences LÃ©gales Couvertes**
- âœ… **Identification vendeur** (nom du vendeur)
- âœ… **Date de vente** (horodatage)
- âœ… **Type et catÃ©gorie produit** (classification F2/F3)
- âœ… **QuantitÃ© vendue** (traÃ§abilitÃ©)
- âœ… **IdentitÃ© acheteur** (nom, prÃ©nom, piÃ¨ce d'identitÃ©)
- âœ… **Photos piÃ¨ce d'identitÃ©** (preuve visuelle)
- âœ… **Archivage numÃ©rique** (IndexedDB + CSV)

### **DonnÃ©es de TraÃ§abilitÃ©**
```javascript
{
  obligatoires: [
    "Date et heure de vente",
    "IdentitÃ© du vendeur", 
    "IdentitÃ© de l'acheteur",
    "Nature et quantitÃ© des produits",
    "CatÃ©gorie rÃ©glementaire"
  ],
  optionnelles: [
    "Photos piÃ¨ces d'identitÃ©",
    "Code produit fabricant",
    "Lieu de naissance acheteur"
  ]
}
```

---

## ğŸ“± **Responsive Design**

### **Breakpoints**
```css
{
  mobile: "max-width: 768px",
  tablet: "768px - 1024px", 
  desktop: "min-width: 1024px"
}
```

### **Adaptations Mobile**
```javascript
{
  navigation: "Onglets empilÃ©s",
  formulaire: "Colonnes -> lignes",
  tableau: "Scroll horizontal",
  modal: "Pleine largeur",
  camera: "OptimisÃ© tactile"
}
```

---

## ğŸ” **Debugging et Maintenance**

### **Outils de Debug IntÃ©grÃ©s**
```javascript
{
  diagnosticComplet: "ğŸ” Debug (Ã©tat + IndexedDB + localStorage)",
  testSuppression: "ğŸ§ª Test sur premiÃ¨re vente",
  testBackup: "ğŸ§ª Test crÃ©ation + tÃ©lÃ©chargement",
  logsDetailles: "Console avec emojis et Ã©tapes"
}
```

### **Gestion d'Erreurs**
```javascript
{
  camera: "Permissions, compatibilitÃ©",
  indexedDB: "Ouverture, transactions, quotas",
  export: "GÃ©nÃ©ration, tÃ©lÃ©chargement",
  validation: "Champs obligatoires, formats"
}
```

---

## ğŸ“¦ **DÃ©ploiement et Installation**

### **PrÃ©requis Navigateur**
```javascript

  optional: [
    "Camera access",
    "Download attribute support"
  ]
}
```

### **Performance**
```javascript
{
  tailleBD: "IllimitÃ©e (selon navigateur)",
  photoCompression: "80% JPEG",
  chargementLazy: "Images dans modal",
  memoire: "State minimal en React"
}
```

---

## ğŸ¯ **Ã‰volutions Futures Possibles**

### **FonctionnalitÃ©s AvancÃ©es**
```javascript
{
  authentification: "Login vendeurs",
  synchronisation: "Multi-appareils",
  notifications: "Rappels rÃ©glementaires",
  recherche: "Filtres avancÃ©s",
  backup: "Cloud storage",
}
```


## ğŸ“š **Documentation Utilisateur**

### **Guide d'Utilisation Rapide**
1. **Nouvelle vente** : Remplir formulaire â†’ Photos (optionnel) â†’ Enregistrer
2. **Consulter historique** : Onglet Historique â†’ Voir/Supprimer
3. **Export donnÃ©es** : Bouton "Exporter CSV" â†’ Fichier tÃ©lÃ©chargÃ©
4. **Sauvegarde** : Automatique + "Backup Auto" manuel

### **RÃ©solution ProblÃ¨mes**
- **CamÃ©ra ne marche pas** : VÃ©rifier permissions navigateur
- **Export CSV vide** : VÃ©rifier qu'il y a des ventes enregistrÃ©es  
- **Suppression ne marche pas** : Utiliser bouton "ğŸ§ª Test Suppression"
- **DonnÃ©es perdues** : Utiliser "Backup Auto" pour rÃ©cupÃ©rer

---

*ğŸ† Application dÃ©veloppÃ©e pour la conformitÃ© rÃ©glementaire franÃ§aise des ventes de feux d'artifice*